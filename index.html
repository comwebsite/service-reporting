<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Service Reporting — version 3.1</title>

<!-- Обязательное подключение FormSubmit -->
<script src="https://formsubmit.co/js/formsubmit.min.js" defer></script>

<style>
  :root{
    --max-w:600px;
    --bg: #ffffff;
    --card: #fbfdff;
    --accent-a: #0b6efd;
    --accent-b: #7c3aed;
    --muted: #6b7280;
    --danger: #ef4444;
    --input-h: 56px;
    --radius: 16px;
    --gap: 14px;
    --shadow: 0 14px 40px rgba(7,16,41,0.06);
    --glass: rgba(255,255,255,0.6);
  }

  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:#071029;-webkit-font-smoothing:antialiased;padding:20px}
  .container{max-width:var(--max-w);margin:0 auto}

  /* Header */
  .header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,var(--accent-a),var(--accent-b));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:18px;box-shadow:0 12px 36px rgba(11,110,253,0.12)}
  .title h1{margin:0;font-size:18px}
  .title p{margin:4px 0 0 0;color:var(--muted);font-size:13px}
  .version{font-size:13px;color:var(--muted);padding:6px 10px;border-radius:10px;background:rgba(7,16,41,0.02)}

  /* Card */
  .card{background:linear-gradient(180deg,#fff,var(--card));padding:22px;border-radius:var(--radius);box-shadow:var(--shadow);border:1px solid rgba(11,110,253,0.04)}
  h2{margin:0 0 12px 0;font-size:16px}

  /* Grid: Date + Time in one row (equal widths) */
  .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:var(--gap);align-items:start}
  .field{display:flex;flex-direction:column;min-width:0} /* min-width:0 важен для корректного сжатия в grid/flex */
  label{font-size:13px;color:var(--muted);margin-bottom:6px;font-weight:700}

  /* Inputs: одинаковая высота, 100% ширина родителя */
  input, select, textarea{
    height:var(--input-h);
    min-height:var(--input-h);
    padding:10px 12px;
    border-radius:12px;
    border:1px solid rgba(7,16,41,0.06);
    font-size:15px;
    background:transparent;
    width:100%;
    box-sizing:border-box;
    transition: box-shadow .16s ease, transform .12s ease, border-color .12s ease;
  }
  input::placeholder{color:#bfc9d9}
  input:focus, select:focus, textarea:focus{
    outline:none;
    box-shadow:0 10px 30px rgba(11,110,253,0.08);
    border-color: rgba(11,110,253,0.18);
    transform:translateY(-2px);
  }

  /* Hints / errors */
  .hint{font-size:12px;color:var(--danger);margin-top:6px;display:none}
  .hint.show{display:block}

  /* Stacked fields below date/time */
  .stack{display:flex;flex-direction:column;gap:12px;margin-top:12px}

  /* Submit centered */
  .actions{display:flex;justify-content:center;margin-top:18px}
  button.submit{
    background:linear-gradient(90deg,var(--accent-a),var(--accent-b));
    color:#fff;border:none;padding:12px 28px;border-radius:12px;font-weight:800;cursor:pointer;
    box-shadow:0 14px 40px rgba(11,110,253,0.12);transition:transform .12s ease;
  }
  button.submit:active{transform:translateY(1px)}
  button[disabled]{opacity:.6;cursor:not-allowed}

  /* Toast */
  .toast{position:fixed;right:18px;bottom:18px;padding:10px 14px;border-radius:10px;color:#fff;background:linear-gradient(90deg,var(--accent-a),var(--accent-b));display:none;z-index:9999}

  /* Small screens: stack date/time */
  @media (max-width:720px){
    .form-grid{grid-template-columns:1fr;gap:12px}
    .logo{width:56px;height:56px}
    input,select,textarea{height:52px}
  }
</style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="brand">
        <div class="logo">SR</div>
        <div class="title">
          <h1>Service Reporting</h1>
          <p>Максимализм в плоском стиле</p>
        </div>
      </div>
      <div class="version">version 3.1</div>
    </header>

    <main class="card" aria-labelledby="formTitle">
      <h2 id="formTitle">Отчёт о сервисе</h2>

      <form id="reportForm" action="https://formsubmit.co/communityofdevelopingcraftsmen@gmail.com" method="POST" autocomplete="off" novalidate>
        <!-- FormSubmit hidden fields -->
        <input type="hidden" name="_subject" value="New Service Report">
        <input type="hidden" name="_next" value="https://formsubmit.co/thank-you">
        <input type="hidden" name="_captcha" value="false">

        <!-- Date + Time row (equal widths) -->
        <div class="form-grid" role="group" aria-label="Date and time">
          <div class="field">
            <label for="dateText">Date</label>
            <div style="position:relative">
              <input id="dateText" name="Date" type="text" placeholder="DD.MM.YYYY" inputmode="numeric" aria-describedby="dateHint" />
              <!-- native date picker (hidden) for mobile convenience -->
              <input id="datePicker" type="date" style="display:none" />
            </div>
            <div id="dateHint" class="hint">Введите дату в формате DD.MM.YYYY</div>
          </div>

          <div class="field">
            <label for="time">Time</label>
            <input id="time" name="Time" type="time" step="60" aria-describedby="timeHint" />
            <div id="timeHint" class="hint">Введите время в формате HH:MM</div>
          </div>
        </div>

        <!-- Stacked fields -->
        <div class="stack" role="group" aria-label="Report fields">
          <div class="field">
            <label for="temp">Temperature</label>
            <input id="temp" name="Temperature" type="text" placeholder="e.g. 23.5 or 23,5" inputmode="decimal" aria-describedby="tempHint" />
            <div id="tempHint" class="hint">Только цифры, допускаются . или ,</div>
          </div>

          <div class="field">
            <label for="hours">Working hours</label>
            <input id="hours" name="Working hours" type="text" placeholder="e.g. 8 or 8:30" inputmode="numeric" aria-describedby="hoursHint" />
            <div id="hoursHint" class="hint">Только цифры, допускается :</div>
          </div>

          <div class="field">
            <label for="difficulty">Work difficulty</label>
            <select id="difficulty" name="Work difficulty" required aria-describedby="diffHint">
              <option value="" disabled selected>Select difficulty</option>
              <option>Neutral</option>
              <option>Easy</option>
              <option>Moderate</option>
              <option>Hard</option>
            </select>
            <div id="diffHint" class="hint">Выберите уровень сложности</div>
          </div>

          <div class="field">
            <label for="shift">Shift type</label>
            <select id="shift" name="Shift type" required aria-describedby="shiftHint">
              <option value="" disabled selected>Select shift</option>
              <option>Day</option>
              <option>Night</option>
            </select>
            <div id="shiftHint" class="hint">Выберите смену</div>
          </div>

          <div class="field">
            <label for="reported">Reported by</label>
            <input id="reported" name="Reported by" type="text" placeholder="Your name" aria-describedby="reportedHint" />
            <div id="reportedHint" class="hint">Введите имя</div>
          </div>
        </div>

        <div class="actions">
          <button type="submit" id="submitBtn" class="submit">Submit report</button>
        </div>
      </form>
    </main>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite">Report sent</div>

<script>
(() => {
  // Elements
  const form = document.getElementById('reportForm');
  const dateText = document.getElementById('dateText');
  const datePicker = document.getElementById('datePicker');
  const timeInput = document.getElementById('time');
  const temp = document.getElementById('temp');
  const hours = document.getElementById('hours');
  const difficulty = document.getElementById('difficulty');
  const shift = document.getElementById('shift');
  const reported = document.getElementById('reported');
  const submitBtn = document.getElementById('submitBtn');
  const toast = document.getElementById('toast');

  // Regex validators
  const reDate = /^([0-3]\d)\.([0-1]\d)\.(\d{4})$/;
  const reTime = /^([01]\d|2[0-3]):[0-5]\d$/;
  const reTemp = /^\d+([.,]\d+)?$/;
  const reHours = /^\d+(:\d+)?$/;

  // Open native date picker on focus (mobile friendly)
  dateText.addEventListener('focus', () => {
    if (datePicker.showPicker) datePicker.showPicker();
  });

  // Sync native date -> text (DD.MM.YYYY)
  datePicker.addEventListener('change', () => {
    if (!datePicker.value) return;
    const d = new Date(datePicker.value);
    if (isNaN(d)) return;
    const dd = String(d.getDate()).padStart(2, '0');
    const mm = String(d.getMonth() + 1).padStart(2, '0');
    const yyyy = d.getFullYear();
    dateText.value = `${dd}.${mm}.${yyyy}`;
    hideHint('dateHint');
  });

  // Validate date on blur and show hint if invalid
  dateText.addEventListener('blur', () => {
    const v = dateText.value.trim();
    if (!v) { showHint('dateHint'); return; }
    const m = v.match(reDate);
    if (!m) { showHint('dateHint'); return; }
    const dd = parseInt(m[1], 10), mm = parseInt(m[2], 10), yyyy = parseInt(m[3], 10);
    const dt = new Date(yyyy, mm - 1, dd);
    if (dt.getFullYear() !== yyyy || dt.getMonth() !== mm - 1 || dt.getDate() !== dd) { showHint('dateHint'); return; }
    hideHint('dateHint');
  });

  // Input sanitizers
  temp.addEventListener('input', () => temp.value = temp.value.replace(/[^\d.,]/g, ''));
  hours.addEventListener('input', () => hours.value = hours.value.replace(/[^\d:]/g, ''));

  // Hint helpers
  function showHint(id){ const el = document.getElementById(id); if(el) el.classList.add('show'); }
  function hideHint(id){ const el = document.getElementById(id); if(el) el.classList.remove('show'); }

  // Toast helper
  function showToast(msg){
    toast.textContent = msg;
    toast.style.display = 'block';
    setTimeout(()=> toast.style.display = 'none', 3000);
  }

  // Short beep on success
  function playBeep(){
    try{
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = 'sine';
      o.frequency.value = 880;
      o.connect(g);
      g.connect(ctx.destination);
      g.gain.setValueAtTime(0.0001, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.12, ctx.currentTime + 0.02);
      o.start();
      g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.28);
      o.stop(ctx.currentTime + 0.3);
    }catch(e){}
  }

  // Submit handler
  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    // Basic validation
    let ok = true;
    const dateVal = dateText.value.trim();
    if (!reDate.test(dateVal)) { showHint('dateHint'); ok = false; } else hideHint('dateHint');
    if (!reTime.test(timeInput.value)) { showHint('timeHint'); ok = false; } else hideHint('timeHint');
    if (!reTemp.test(temp.value.trim())) { showHint('tempHint'); ok = false; } else hideHint('tempHint');
    if (!reHours.test(hours.value.trim())) { showHint('hoursHint'); ok = false; } else hideHint('hoursHint');
    if (!difficulty.value) { showHint('diffHint'); ok = false; } else hideHint('diffHint');
    if (!shift.value) { showHint('shiftHint'); ok = false; } else hideHint('shiftHint');
    if (!reported.value.trim()) { showHint('reportedHint'); ok = false; } else hideHint('reportedHint');

    if (!ok) return;

    // Build FormData with exact field names
    const fd = new FormData();
    fd.append('Date', dateVal);
    fd.append('Time', timeInput.value);
    fd.append('Temperature', temp.value.trim());
    fd.append('Working hours', hours.value.trim());
    fd.append('Work difficulty', difficulty.value);
    fd.append('Shift type', shift.value);
    fd.append('Reported by', reported.value.trim());
    fd.append('_subject', 'New Service Report');

    // UI lock
    submitBtn.disabled = true;
    submitBtn.textContent = 'Sending...';

    try{
      const res = await fetch(form.action, {
        method: 'POST',
        body: fd,
        mode: 'cors',
        headers: { 'Accept': 'application/json' }
      });

      if (res.ok){
        playBeep();
        showToast('Report sent successfully');
        form.reset();
      } else {
        // Try to read JSON error message
        let msg = `Send failed (${res.status})`;
        try{ const j = await res.json(); if (j && j.message) msg = j.message; } catch(_) {}
        alert(msg);
      }
    }catch(err){
      alert('Network error: ' + err.message);
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Submit report';
    }
  });
})();
</script>
</body>
</html>