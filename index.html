<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Service Reporting</title>

<!-- Подключение FormSubmit (обязательное по запросу) -->
<script src="https://formsubmit.co/js/formsubmit.min.js" defer></script>

<style>
  :root{
    --bg:#ffffff;
    --card:#f7f8fb;
    --accent:#0b6efd;
    --accent-2:#7c3aed;
    --muted:#6b7280;
    --glass: rgba(255,255,255,0.6);
    --success:#16a34a;
    --danger:#ef4444;
    --radius:18px;
  }

  /* Общая страница */
  html,body{
    height:100%;
    margin:0;
    font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background:
      radial-gradient(1200px 600px at 10% 10%, rgba(124,58,237,0.06), transparent 8%),
      radial-gradient(900px 500px at 90% 90%, rgba(11,110,253,0.04), transparent 8%),
      var(--bg);
    color:#0f172a;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:32px;
    box-sizing:border-box;
  }

  /* Контейнер */
  .wrap{
    max-width:980px;
    margin:0 auto;
    display:grid;
    grid-template-columns: 1fr 420px;
    gap:28px;
    align-items:start;
  }

  /* Заголовок */
  header.app-header{
    grid-column:1 / -1;
    display:flex;
    align-items:center;
    gap:18px;
    margin-bottom:6px;
  }
  .logo{
    width:72px;
    height:72px;
    border-radius:16px;
    background:linear-gradient(135deg,var(--accent),var(--accent-2));
    display:flex;
    align-items:center;
    justify-content:center;
    color:white;
    font-weight:700;
    font-size:20px;
    box-shadow: 0 8px 30px rgba(12,74,255,0.08);
  }
  .title{
    display:flex;
    flex-direction:column;
  }
  .title h1{
    margin:0;
    font-size:20px;
    letter-spacing:0.2px;
  }
  .title p{
    margin:2px 0 0 0;
    color:var(--muted);
    font-size:13px;
  }

  /* Карточка формы */
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,0.9), var(--card));
    border-radius:var(--radius);
    padding:22px;
    box-shadow: 0 10px 30px rgba(15,23,42,0.04);
    border:1px solid rgba(12,74,255,0.04);
  }

  form .row{
    display:flex;
    gap:12px;
    align-items:center;
    margin-bottom:14px;
  }

  /* Date и Time в одной строке */
  .row.inline{
    display:flex;
    gap:12px;
  }
  .field{
    flex:1;
    display:flex;
    flex-direction:column;
  }
  label{
    font-size:12px;
    color:var(--muted);
    margin-bottom:8px;
    font-weight:600;
  }
  input[type="text"],
  input[type="time"],
  input[type="date"],
  select{
    height:48px;
    border-radius:12px;
    border:1px solid rgba(15,23,42,0.06);
    padding:10px 14px;
    font-size:15px;
    outline:none;
    background:transparent;
    transition:box-shadow .18s, transform .12s;
  }
  input[type="text"]:focus,
  input[type="time"]:focus,
  select:focus{
    box-shadow: 0 6px 20px rgba(11,110,253,0.08);
    transform:translateY(-1px);
    border-color: rgba(11,110,253,0.18);
  }

  /* Специальный стиль для видимого поля даты */
  .date-wrap{
    position:relative;
  }
  .date-wrap .calendar{
    position:absolute;
    right:10px;
    top:50%;
    transform:translateY(-50%);
    width:36px;
    height:36px;
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius:10px;
    background:linear-gradient(180deg, rgba(11,110,253,0.06), rgba(124,58,237,0.04));
    cursor:pointer;
  }

  /* Кнопка */
  .actions{
    display:flex;
    gap:12px;
    align-items:center;
    margin-top:8px;
  }
  button.submit{
    background:linear-gradient(90deg,var(--accent),var(--accent-2));
    color:white;
    border:none;
    padding:12px 18px;
    border-radius:12px;
    font-weight:700;
    cursor:pointer;
    box-shadow: 0 12px 30px rgba(11,110,253,0.12);
    transition:transform .12s, box-shadow .12s, opacity .12s;
  }
  button.submit:active{ transform:translateY(1px) scale(.998); }
  button.submit[disabled]{ opacity:.6; cursor:not-allowed; }

  /* Сайдбар с декоративными элементами и инструкцией */
  .side{
    display:flex;
    flex-direction:column;
    gap:18px;
  }
  .decor{
    border-radius:14px;
    padding:18px;
    background:linear-gradient(180deg, rgba(124,58,237,0.06), rgba(11,110,253,0.03));
    min-height:160px;
    display:flex;
    align-items:center;
    justify-content:center;
    color:var(--muted);
    font-size:13px;
  }
  .meta{
    background:linear-gradient(180deg, rgba(255,255,255,0.9), #fff);
    border-radius:14px;
    padding:14px;
    border:1px solid rgba(12,74,255,0.04);
  }
  .meta h3{ margin:0 0 8px 0; font-size:14px; }
  .meta p{ margin:0; color:var(--muted); font-size:13px; }

  /* Подсказки ошибок */
  .hint{
    font-size:12px;
    color:var(--danger);
    margin-top:6px;
    display:none;
  }
  .hint.show{ display:block; }

  /* Успех */
  .toast{
    position:fixed;
    right:20px;
    bottom:20px;
    background:linear-gradient(90deg,var(--accent),var(--accent-2));
    color:white;
    padding:12px 16px;
    border-radius:12px;
    box-shadow: 0 12px 30px rgba(11,110,253,0.18);
    transform:translateY(20px);
    opacity:0;
    transition:all .28s;
    z-index:9999;
  }
  .toast.show{ transform:translateY(0); opacity:1; }

  /* Responsive */
  @media (max-width:980px){
    .wrap{ grid-template-columns: 1fr; padding:18px; gap:18px; }
    .side{ order:2; }
  }
  @media (max-width:520px){
    .row.inline{ flex-direction:column; }
    input[type="text"], select, input[type="time"]{ height:46px; }
    .logo{ width:56px; height:56px; font-size:18px; border-radius:12px; }
  }
</style>
</head>
<body>
  <div class="wrap">
    <header class="app-header">
      <div class="logo">SR</div>
      <div class="title">
        <h1>Service Reporting</h1>
        <p>Удобная программа для отчётов</p>
      </div>
    </header>

    <!-- Форма -->
    <section class="card">
      <form id="reportForm" autocomplete="off" novalidate>
        <!-- Скрытое поле для отправки через FormSubmit -->
        <input type="hidden" name="_subject" value="New Service Report" />
        <input type="hidden" name="_next" value="https://formsubmit.co/thank-you" />
        <!-- visible date/time row -->
        <div class="row inline">
          <div class="field date-wrap" style="flex:1;">
            <label for="dateText">Date</label>
            <input id="dateText" type="text" placeholder="DD.MM.YYYY" inputmode="numeric" />
            <div class="calendar" id="openDate" title="Open calendar" aria-hidden="true">
              <!-- calendar svg -->
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <rect x="3" y="5" width="18" height="16" rx="2" stroke="white" stroke-opacity="0.9" stroke-width="1.4"/>
                <path d="M16 3v4M8 3v4" stroke="white" stroke-opacity="0.9" stroke-width="1.4" stroke-linecap="round"/>
              </svg>
            </div>
            <div class="hint" id="dateHint">Введите дату в формате DD.MM.YYYY</div>
            <!-- скрытый реальный date input для нативного выбора -->
            <input id="datePicker" type="date" style="display:none;" />
            <!-- скрытое поле, которое будет отправлено -->
            <input id="dateForSend" type="hidden" name="Date" />
          </div>

          <div class="field" style="width:180px;">
            <label for="time">Time</label>
            <input id="time" name="Time" type="time" placeholder="HH:MM" step="60" />
            <div class="hint" id="timeHint">Введите время в формате HH:MM</div>
          </div>
        </div>

        <!-- Temperature -->
        <div class="row">
          <div class="field">
            <label for="temp">Temperature</label>
            <input id="temp" name="Temperature" type="text" placeholder="Enter the temperature" inputmode="decimal" />
            <div class="hint" id="tempHint">Только цифры, допускаются разделители . или ,</div>
          </div>
        </div>

        <!-- Working hours -->
        <div class="row">
          <div class="field">
            <label for="hours">Working hours</label>
            <input id="hours" name="Working hours" type="text" placeholder="Enter hours (e.g. 8 or 8:30)" inputmode="numeric" />
            <div class="hint" id="hoursHint">Только цифры, допускается двоеточие</div>
          </div>
        </div>

        <!-- Work difficulty -->
        <div class="row">
          <div class="field">
            <label for="difficulty">Work difficulty</label>
            <select id="difficulty" name="Work difficulty" required>
              <option value="" disabled selected>Select difficulty</option>
              <option>Neutral</option>
              <option>Easy</option>
              <option>Moderate</option>
              <option>Hard</option>
            </select>
            <div class="hint" id="diffHint">Выберите уровень сложности</div>
          </div>
        </div>

        <!-- Shift type -->
        <div class="row">
          <div class="field">
            <label for="shift">Shift type</label>
            <select id="shift" name="Shift type" required>
              <option value="" disabled selected>Select shift</option>
              <option>Day</option>
              <option>Night</option>
            </select>
            <div class="hint" id="shiftHint">Выберите смену</div>
          </div>
        </div>

        <!-- Reported by -->
        <div class="row">
          <div class="field">
            <label for="reported">Reported by</label>
            <input id="reported" name="Reported by" type="text" placeholder="Your name" />
            <div class="hint" id="reportedHint">Введите имя</div>
          </div>
        </div>

        <div class="actions">
          <button type="submit" class="submit" id="submitBtn">Submit report</button>
          <button type="button" id="clearBtn" style="background:transparent;border:none;color:var(--muted);font-weight:700;cursor:pointer;padding:8px 10px;border-radius:10px;">Clear</button>
        </div>
      </form>
    </section>

    <!-- Сайдбар -->
    <aside class="side">
      <div class="decor card">
        <svg width="100%" height="100%" viewBox="0 0 600 200" preserveAspectRatio="none" aria-hidden="true">
          <defs>
            <linearGradient id="g1" x1="0" x2="1">
              <stop offset="0" stop-color="#7c3aed" stop-opacity="0.12"/>
              <stop offset="1" stop-color="#0b6efd" stop-opacity="0.06"/>
            </linearGradient>
          </defs>
          <rect x="0" y="0" width="600" height="200" fill="url(#g1)"/>
          <g transform="translate(20,20)" fill="none" stroke="#7c3aed" stroke-opacity="0.08" stroke-width="2">
            <path d="M0 120 Q120 0 240 120 T480 120" />
            <circle cx="520" cy="40" r="28" stroke-opacity="0.06"/>
          </g>
        </svg>
      </div>

      <div class="meta card">
        <h3>Инструкция</h3>
        <p><strong>Date</strong> — выберите дату или введите в формате <strong>DD.MM.YYYY</strong>. <strong>Time</strong> — формат <strong>HH:MM</strong>. Температура допускает <strong>.</strong> или <strong>,</strong>. Рабочие часы — цифры и опционально <strong>:</strong>. Выберите сложность и смену. Нажмите <strong>Submit report</strong>.</p>
      </div>
    </aside>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite">Report sent successfully</div>

<script>
(function(){
  // Элементы
  const dateText = document.getElementById('dateText');
  const datePicker = document.getElementById('datePicker');
  const dateForSend = document.getElementById('dateForSend');
  const openDate = document.getElementById('openDate');
  const timeInput = document.getElementById('time');
  const temp = document.getElementById('temp');
  const hours = document.getElementById('hours');
  const difficulty = document.getElementById('difficulty');
  const shift = document.getElementById('shift');
  const reported = document.getElementById('reported');
  const form = document.getElementById('reportForm');
  const submitBtn = document.getElementById('submitBtn');
  const clearBtn = document.getElementById('clearBtn');
  const toast = document.getElementById('toast');

  // Вспомогательные регулярки
  const reDate = /^([0-3]\d)\.([0-1]\d)\.(\d{4})$/;
  const reTemp = /^\d+([.,]\d+)?$/;
  const reHours = /^\d+(:\d+)?$/;
  const reTime = /^([01]\d|2[0-3]):[0-5]\d$/;

  // Открыть нативный date picker
  openDate.addEventListener('click', ()=> datePicker.showPicker ? datePicker.showPicker() : datePicker.click());

  // При выборе в нативном picker форматируем в DD.MM.YYYY
  datePicker.addEventListener('change', ()=>{
    if(!datePicker.value) return;
    const d = new Date(datePicker.value);
    if(isNaN(d)) return;
    const dd = String(d.getDate()).padStart(2,'0');
    const mm = String(d.getMonth()+1).padStart(2,'0');
    const yyyy = d.getFullYear();
    const formatted = `${dd}.${mm}.${yyyy}`;
    dateText.value = formatted;
    dateForSend.value = formatted;
    hideHint('dateHint');
  });

  // Ввод вручную в поле даты
  dateText.addEventListener('blur', ()=>{
    const v = dateText.value.trim();
    if(!v){
      dateForSend.value = '';
      return;
    }
    const m = v.match(reDate);
    if(!m){
      showHint('dateHint');
      dateForSend.value = '';
      return;
    }
    // проверка валидности даты
    const dd = parseInt(m[1],10), mm = parseInt(m[2],10), yyyy = parseInt(m[3],10);
    const dt = new Date(yyyy, mm-1, dd);
    if(dt.getFullYear() !== yyyy || dt.getMonth() !== mm-1 || dt.getDate() !== dd){
      showHint('dateHint');
      dateForSend.value = '';
      return;
    }
    hideHint('dateHint');
    // установить скрытое поле и синхронизировать нативный picker
    dateForSend.value = v;
    // синхронизируем datePicker в формате YYYY-MM-DD
    const iso = `${yyyy}-${String(mm).padStart(2,'0')}-${String(dd).padStart(2,'0')}`;
    datePicker.value = iso;
  });

  // Подсказки
  function showHint(id){ document.getElementById(id).classList.add('show'); }
  function hideHint(id){ document.getElementById(id).classList.remove('show'); }

  // Очистка формы
  clearBtn.addEventListener('click', ()=>{
    form.reset();
    dateText.value = '';
    dateForSend.value = '';
    hideAllHints();
  });

  function hideAllHints(){
    ['dateHint','timeHint','tempHint','hoursHint','diffHint','shiftHint','reportedHint'].forEach(h=>hideHint(h));
  }

  // Валидация перед отправкой
  function validateAll(){
    let ok = true;
    // Date
    if(!dateForSend.value || !reDate.test(dateForSend.value)){
      showHint('dateHint'); ok = false;
    } else hideHint('dateHint');

    // Time
    if(!timeInput.value || !reTime.test(timeInput.value)){
      showHint('timeHint'); ok = false;
    } else hideHint('timeHint');

    // Temperature (может быть пустым? по ТЗ не сказано, но допустим обязателен)
    if(!temp.value || !reTemp.test(temp.value.trim())){
      showHint('tempHint'); ok = false;
    } else hideHint('tempHint');

    // Working hours
    if(!hours.value || !reHours.test(hours.value.trim())){
      showHint('hoursHint'); ok = false;
    } else hideHint('hoursHint');

    // Difficulty
    if(!difficulty.value){
      showHint('diffHint'); ok = false;
    } else hideHint('diffHint');

    // Shift
    if(!shift.value){
      showHint('shiftHint'); ok = false;
    } else hideHint('shiftHint');

    // Reported by
    if(!reported.value || reported.value.trim().length < 1){
      showHint('reportedHint'); ok = false;
    } else hideHint('reportedHint');

    return ok;
  }

  // Звук через WebAudio API
  function playBeep(){
    try{
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = 'sine';
      o.frequency.value = 880;
      g.gain.value = 0.0001;
      o.connect(g);
      g.connect(ctx.destination);
      // плавный подъём громкости
      g.gain.exponentialRampToValueAtTime(0.12, ctx.currentTime + 0.02);
      o.start();
      // плавный спад
      g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.28);
      o.stop(ctx.currentTime + 0.3);
    }catch(e){
      // fallback: короткий системный звук (silent)
      console.warn('Audio not available', e);
    }
  }

  // Показ toast
  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add('show');
    setTimeout(()=> toast.classList.remove('show'), 3000);
  }

  // Отправка через fetch на FormSubmit
  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    if(!validateAll()) return;

    submitBtn.disabled = true;
    submitBtn.textContent = 'Sending...';

    // Собираем данные
    const payload = new FormData();
    payload.append('Date', dateForSend.value);
    payload.append('Time', timeInput.value);
    payload.append('Temperature', temp.value.trim());
    payload.append('Working hours', hours.value.trim());
    payload.append('Work difficulty', difficulty.value);
    payload.append('Shift type', shift.value);
    payload.append('Reported by', reported.value.trim());
    payload.append('_subject', 'New Service Report');
    // Отправляем на formsubmit.co
    try{
      const response = await fetch('https://formsubmit.co/pasa79427@gmail.com', {
        method: 'POST',
        body: payload,
        mode: 'cors',
        headers: {
          'Accept': 'application/json'
        }
      });

      // Если сервис вернул JSON с ошибкой, обработаем
      if(response.ok){
        playBeep();
        showToast('Report sent successfully');
        form.reset();
        dateText.value = '';
        dateForSend.value = '';
      } else {
        // Попытка прочитать json
        let txt = 'Send failed';
        try{
          const j = await response.json();
          if(j && j.message) txt = j.message;
        }catch(_){}
        showToast(txt);
      }
    }catch(err){
      console.error(err);
      showToast('Network error, try again');
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Submit report';
    }
  });

  // Небольшая оптимизация: при вводе в temp и hours — убрать лишние пробелы
  temp.addEventListener('input', ()=> temp.value = temp.value.replace(/[^\d.,]/g,''));
  hours.addEventListener('input', ()=> hours.value = hours.value.replace(/[^\d:]/g,''));
})();
</script>
</body>
</html>