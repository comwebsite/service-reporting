<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Service Reporting — v5.0</title>
<meta name="description" content="Service Reporting — отчетный бланк, Liquid Glass UI, версия 5.0" />
<style>
  :root{
    --bg1: linear-gradient(135deg, rgba(10,18,34,1) 0%, rgba(30,10,50,1) 100%);
    --glass-border: rgba(255,255,255,0.08);
    --text: #eaf6ff;
    --muted: rgba(230,240,255,0.6);
    --accent: rgba(120,200,255,0.18);
    --card-radius: 20px;
    --cell-size: 160px; /* базовый размер квадрата; JS будет подстраивать */
    --gap: 18px;
  }

  html,body{
    height:100%;
    margin:0;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: var(--bg1);
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* decorative blobs */
  .scene{ position:fixed; inset:0; pointer-events:none; z-index:0; overflow:hidden; }
  .blob{ position:absolute; filter: blur(40px) saturate(120%); opacity:0.9; mix-blend-mode:screen; transform-origin:center; animation: float 14s ease-in-out infinite; }
  .blob.b1{ width:520px;height:520px; left:-8%; top:-12%; background:radial-gradient(circle at 30% 30%, rgba(120,200,255,0.36), rgba(80,60,180,0.10)); }
  .blob.b2{ width:420px;height:420px; right:-6%; bottom:-8%; background:radial-gradient(circle at 70% 70%, rgba(255,160,200,0.22), rgba(200,80,160,0.06)); animation-duration:20s; }
  .blob.b3{ width:300px;height:300px; left:6%; bottom:8%; background:radial-gradient(circle at 50% 50%, rgba(120,255,200,0.18), rgba(40,120,120,0.05)); animation-duration:18s; }
  @keyframes float{ 0%{ transform: translateY(0) rotate(0deg) } 50%{ transform: translateY(-28px) rotate(6deg) } 100%{ transform: translateY(0) rotate(0deg) } }

  .wrap{ position:relative; z-index:2; min-height:100vh; display:flex; align-items:center; justify-content:center; padding:36px 18px; box-sizing:border-box; }

  .card{
    width:100%;
    max-width:700px; /* изменено на 700px по твоему комментарию */
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border-radius:var(--card-radius);
    padding:22px;
    box-sizing:border-box;
    backdrop-filter: blur(14px) saturate(120%);
    -webkit-backdrop-filter: blur(14px) saturate(120%);
    border: 1px solid var(--glass-border);
    box-shadow: 0 12px 40px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
    position:relative;
    overflow:visible;
    transition: transform .45s cubic-bezier(.2,.9,.2,1), box-shadow .45s;
  }

  .card:hover{ transform: translateY(-8px) scale(1.01); box-shadow: 0 22px 60px rgba(2,6,23,0.75); }

  header{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:14px; }
  .brand{ display:flex; gap:12px; align-items:center; }
  .logo{ width:52px;height:52px;border-radius:12px; background: linear-gradient(135deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)); display:flex;align-items:center;justify-content:center; box-shadow: 0 6px 18px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.06); position:relative; overflow:hidden; }
  .logo::before{ content:""; position:absolute; inset:0; background: linear-gradient(60deg, rgba(120,200,255,0.18), rgba(255,160,200,0.12)); mix-blend-mode:screen; transform: translateY(-20%); animation: sheen 3.6s linear infinite; }
  @keyframes sheen{ 0%{transform:translateX(-120%)} 100%{transform:translateX(120%)} }
  h1{ font-size:20px; margin:0; letter-spacing:0.2px; }
  .meta{ font-size:12px; color:var(--muted); }

  form{ display:grid; grid-template-columns: 1fr; gap:16px; align-items:start; }

  /* Row with Date & Time: responsive squares */
  .row-datetime{
    display:grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--gap);
    justify-items:center;
    align-items:start;
    width:100%;
  }

  /* Ensure squares: use aspect-ratio and max-width based on computed --cell-size */
  .row-datetime .glass-field{
    width: calc(var(--cell-size));
    aspect-ratio: 1 / 1;
    min-width: 96px;
    max-width: 48%;
    box-sizing:border-box;
  }

  /* On very narrow screens keep them side-by-side but allow them to shrink */
  @media (max-width:420px){
    .row-datetime{ grid-template-columns: repeat(2, minmax(0,1fr)); gap:12px; }
    .row-datetime .glass-field{ width:100%; max-width:100%; aspect-ratio: 1 / 1; min-width:88px; }
  }

  .glass-field{
    border-radius:14px;
    padding:12px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border: 1px solid rgba(255,255,255,0.06);
    box-shadow: 0 8px 22px rgba(2,6,23,0.45), inset 0 1px 0 rgba(255,255,255,0.02);
    display:flex;
    flex-direction:column;
    justify-content:center;
    position:relative;
    overflow:hidden;
    transition: transform .35s ease, box-shadow .35s ease;
  }
  .glass-field:hover{ transform: translateY(-6px); box-shadow: 0 18px 40px rgba(2,6,23,0.6); }

  label{ font-size:13px; color:var(--muted); margin-bottom:8px; display:block; }

  input[type="text"], input[type="number"], select{
    width:100%;
    height:44px;
    border-radius:10px;
    border:1px solid rgba(255,255,255,0.06);
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
    color:var(--text);
    padding:10px 12px;
    box-sizing:border-box;
    outline:none;
    transition: box-shadow .25s, transform .18s;
    font-size:15px;
    backdrop-filter: blur(6px);
  }

  /* For inputs inside square fields center them vertically */
  .row-datetime .glass-field > input,
  .row-datetime .glass-field > .hint{
    margin-top:auto;
    margin-bottom:8px;
  }

  input[readonly]{ cursor:default; color:var(--muted); font-weight:600; }

  input:focus, select:focus{ box-shadow: 0 6px 30px rgba(120,200,255,0.12); transform: translateY(-2px); border-color: rgba(120,200,255,0.28); }

  .full-row{ display:grid; grid-template-columns: 1fr; }
  .two-cols{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
  @media (max-width:720px){ .two-cols{ grid-template-columns: 1fr; } }

  .hint{ font-size:12px; color:var(--muted); margin-top:8px; }
  .error{ color:#ff8b8b; font-size:13px; margin-top:8px; display:none; }

  .actions{ display:flex; gap:12px; align-items:center; justify-content:space-between; margin-top:6px; flex-wrap:wrap; }
  .version{ font-size:12px; color:var(--muted); }

  .btn{ background: linear-gradient(90deg, rgba(120,200,255,0.18), rgba(160,120,255,0.14)); border:1px solid rgba(255,255,255,0.08); color:var(--text); padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:700; letter-spacing:0.3px; box-shadow: 0 8px 30px rgba(120,200,255,0.06); transition: transform .18s ease, box-shadow .18s ease; }
  .btn.primary{ background: linear-gradient(90deg, rgba(120,230,200,0.22), rgba(120,200,255,0.18)); color:#04202a; }
  .btn:active{ transform: translateY(2px) scale(.998); }

  .sending{ display:inline-flex; gap:8px; align-items:center; padding:8px 12px; border-radius:999px; background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.04); color:var(--muted); font-size:13px; }
  .dot{ width:8px;height:8px;border-radius:50%; background:var(--accent); animation: blink 1s infinite; }
  .dot:nth-child(2){ animation-delay:.12s; } .dot:nth-child(3){ animation-delay:.24s; }
  @keyframes blink{ 0%{opacity:0.2; transform:translateY(0)} 50%{opacity:1; transform:translateY(-6px)} 100%{opacity:0.2; transform:translateY(0)} }

  .toast{ position:fixed; right:18px; bottom:18px; background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02)); border:1px solid rgba(255,255,255,0.06); padding:12px 16px; border-radius:12px; color:var(--text); box-shadow: 0 10px 30px rgba(0,0,0,0.5); transform: translateY(20px); opacity:0; transition: transform .35s, opacity .35s; z-index:999; }
  .toast.show{ transform: translateY(0); opacity:1; }

  /* small input appear animations */
  input, select{ will-change: transform, box-shadow; }

  /* accessibility focus ring */
  :focus{ outline: none; box-shadow: 0 0 0 3px rgba(120,200,255,0.12); border-radius:8px; }

  /* final responsive tweaks */
  @media (max-width:360px){
    :root{ --gap: 10px; }
    .card{ padding:14px; border-radius:12px; }
    h1{ font-size:18px; }
  }
</style>
</head>
<body>
  <div class="scene" aria-hidden="true">
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="blob b3"></div>
  </div>

  <div class="wrap">
    <main class="card" role="main" aria-labelledby="title">
      <header>
        <div class="brand">
          <div class="logo" aria-hidden="true">
            <svg width="34" height="34" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#7CD1FF"/><stop offset="1" stop-color="#C78BFF"/></linearGradient></defs>
              <rect x="3" y="3" width="18" height="18" rx="4" fill="url(#g)" opacity="0.95"/>
              <path d="M7 12h10" stroke="#04202a" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" opacity="0.9"/>
            </svg>
          </div>
          <div>
            <h1 id="title">Service Reporting</h1>
            <div class="meta">Отчетный бланк • версия <strong>5.0</strong></div>
          </div>
        </div>
        <div class="version">Liquid Glass UI</div>
      </header>

      <form id="reportForm" autocomplete="off" novalidate>
        <!-- Date & Time row (squares) -->
        <div class="row-datetime" id="rowDatetime">
          <div class="glass-field">
            <label for="date">Date</label>
            <input id="date" name="date" type="text" readonly aria-readonly="true" />
            <div class="hint">Дата заполняется автоматически</div>
          </div>

          <div class="glass-field">
            <label for="time">Time</label>
            <input id="time" name="time" type="text" readonly aria-readonly="true" />
            <div class="hint">Время заполняется автоматически</div>
          </div>
        </div>

        <!-- Temperature -->
        <div class="glass-field full-row">
          <label for="temperature">Temperature</label>
          <input id="temperature" name="temperature" type="text" inputmode="numeric" placeholder="e.g. 23.5, -5, +12.3" aria-describedby="tempHint" />
          <div id="tempHint" class="hint">Только цифры и символы <strong>. , - +</strong> разрешены</div>
          <div id="tempError" class="error">Недопустимые символы — используйте только цифры и . , - +</div>
        </div>

        <!-- Working hours -->
        <div class="glass-field full-row">
          <label for="hours">Working hours</label>
          <input id="hours" name="working_hours" type="text" inputmode="numeric" placeholder="e.g. 8, 7.5, 4-6" aria-describedby="hoursHint" />
          <div id="hoursHint" class="hint">Только цифры и символы <strong>. , - +</strong> разрешены</div>
          <div id="hoursError" class="error">Недопустимые символы — используйте только цифры и . , - +</div>
        </div>

        <!-- How many people -->
        <div class="glass-field full-row">
          <label for="people">How many people have you helped</label>
          <input id="people" name="people_helped" type="number" min="0" inputmode="numeric" placeholder="0" />
          <div class="hint">Введите целое число</div>
        </div>

        <!-- Difficulty & Reported by -->
        <div class="two-cols">
          <div class="glass-field">
            <label for="difficulty">Work difficulty</label>
            <select id="difficulty" name="work_difficulty" required>
              <option value="Neutral">Neutral</option>
              <option value="Moderate">Moderate</option>
              <option value="Hard">Hard</option>
            </select>
            <div class="hint">Выберите уровень сложности</div>
          </div>

          <div class="glass-field">
            <label for="reported">Reported by</label>
            <input id="reported" name="reported_by" type="text" placeholder="Ваше имя" required />
            <div class="hint">Укажите имя, которое будет в отчете</div>
          </div>
        </div>

        <!-- Hidden FormSubmit fields -->
        <input type="hidden" name="_subject" value="New Service Report" />
        <input type="hidden" name="_template" value="table" />
        <input type="hidden" name="_captcha" value="false" />
        <input type="hidden" name="_next" value="https://formsubmit.co/thankyou" />

        <div class="actions">
          <div class="version">Отправка на: <strong>communityofdevelopingcraftsmen@gmail.com</strong></div>
          <div style="display:flex;gap:10px;align-items:center;">
            <button type="button" id="demoFill" class="btn" title="Заполнить демо">Demo fill</button>
            <button type="submit" id="submitBtn" class="btn primary">Submit</button>
          </div>
        </div>
      </form>
    </main>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
/* Responsive squares: compute --cell-size based on .card width so two squares always fit without overflow.
   Logic:
   - available = cardWidth - gap
   - cell = min(maxCell, floor((available - gap) / 2))
   - enforce minCell to keep inputs usable
*/
(function(){
  const root = document.documentElement;
  const card = document.querySelector('.card');
  const row = document.getElementById('rowDatetime');
  const GAP =  parseInt(getComputedStyle(root).getPropertyValue('--gap')) || 18;
  const MAX_CELL = 220; // don't grow too big on wide screens
  const MIN_CELL = 88;  // minimum usable size on very small phones

  function recompute(){
    if(!card) return;
    const style = getComputedStyle(card);
    const cardPaddingLeft = parseFloat(style.paddingLeft) || 0;
    const cardPaddingRight = parseFloat(style.paddingRight) || 0;
    const cardWidth = Math.max(0, card.clientWidth - cardPaddingLeft - cardPaddingRight);
    // available width for two cells including gap between them
    const available = cardWidth;
    // compute candidate cell size
    let cell = Math.floor((available - GAP) / 2);
    if(cell > MAX_CELL) cell = MAX_CELL;
    if(cell < MIN_CELL) cell = MIN_CELL;
    // set CSS variable
    root.style.setProperty('--cell-size', cell + 'px');
  }

  // initial compute and on resize
  recompute();
  // ResizeObserver for card (handles orientation change and dynamic layout)
  if(window.ResizeObserver){
    const ro = new ResizeObserver(recompute);
    ro.observe(card);
  } else {
    window.addEventListener('resize', recompute);
  }

  // Also recompute on orientationchange for some mobile browsers
  window.addEventListener('orientationchange', () => setTimeout(recompute, 120));
})();

/* Date & Time auto-fill */
(function(){
  const dateInput = document.getElementById('date');
  const timeInput = document.getElementById('time');

  function update(){
    const now = new Date();
    const dateStr = now.toLocaleDateString(undefined, { year:'numeric', month:'short', day:'numeric' });
    const timeStr = now.toLocaleTimeString(undefined, { hour:'2-digit', minute:'2-digit' });
    dateInput.value = dateStr;
    timeInput.value = timeStr;
  }
  update();
  setInterval(update, 30_000);
})();

/* Validation and input filtering */
(function(){
  const tempInput = document.getElementById('temperature');
  const hoursInput = document.getElementById('hours');
  const peopleInput = document.getElementById('people');
  const tempError = document.getElementById('tempError');
  const hoursError = document.getElementById('hoursError');

  const allowedPattern = /^[0-9\.\,\-\+\s]*$/;

  function filterInput(el){
    el.addEventListener('input', () => {
      const before = el.value;
      const filtered = before.split('').filter(ch => /[0-9\.\,\-\+\s]/.test(ch)).join('');
      if(filtered !== before){
        const pos = el.selectionStart - (before.length - filtered.length);
        el.value = filtered;
        el.setSelectionRange(pos,pos);
      }
    });
  }
  filterInput(tempInput);
  filterInput(hoursInput);

  peopleInput.addEventListener('input', () => {
    const v = peopleInput.value.replace(/[^\d]/g,'');
    peopleInput.value = v;
  });

  // validation helpers used on submit
  window.validateFieldPattern = function(inputEl, errorEl){
    const v = inputEl.value.trim();
    const ok = v === '' || allowedPattern.test(v);
    if(!ok){
      errorEl.style.display = 'block';
      inputEl.setAttribute('aria-invalid','true');
    } else {
      errorEl.style.display = 'none';
      inputEl.removeAttribute('aria-invalid');
    }
    return ok;
  };
})();

/* Toast */
(function(){
  const toast = document.getElementById('toast');
  let timer = null;
  window.showToast = function(msg, ms=3000){
    toast.textContent = msg;
    toast.classList.add('show');
    if(timer) clearTimeout(timer);
    timer = setTimeout(()=> toast.classList.remove('show'), ms);
  };
})();

/* Form submit via FormSubmit (AJAX with fallback) */
(function(){
  const form = document.getElementById('reportForm');
  const submitBtn = document.getElementById('submitBtn');
  const demoBtn = document.getElementById('demoFill');
  const EMAIL_ENDPOINT = 'https://formsubmit.co/communityofdevelopingcraftsmen@gmail.com';

  demoBtn.addEventListener('click', () => {
    document.getElementById('temperature').value = "23.5";
    document.getElementById('hours').value = "8";
    document.getElementById('people').value = "12";
    document.getElementById('difficulty').value = 'Moderate';
    document.getElementById('reported').value = 'Иван Иванов';
    showToast('Демо-данные заполнены', 1400);
  });

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const temp = document.getElementById('temperature');
    const hours = document.getElementById('hours');
    const people = document.getElementById('people');
    const reported = document.getElementById('reported');
    const difficulty = document.getElementById('difficulty');

    const okTemp = window.validateFieldPattern(temp, document.getElementById('tempError'));
    const okHours = window.validateFieldPattern(hours, document.getElementById('hoursError'));
    const okPeople = people.value.trim() === '' || /^\d+$/.test(people.value.trim());
    if(!okPeople){ showToast('Поле "How many people" должно быть целым числом', 2600); people.focus(); return; }
    if(!okTemp || !okHours){ showToast('Проверьте поля на недопустимые символы', 2200); return; }

    // prepare FormData
    const fd = new FormData();
    fd.append('date', document.getElementById('date').value);
    fd.append('time', document.getElementById('time').value);
    fd.append('temperature', temp.value);
    fd.append('working_hours', hours.value);
    fd.append('people_helped', people.value);
    fd.append('work_difficulty', difficulty.value);
    fd.append('reported_by', reported.value || '');
    fd.append('_subject', 'New Service Report');
    fd.append('_template', 'table');
    fd.append('_captcha', 'false');

    // UI
    const orig = submitBtn.innerHTML;
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span class="sending"><span class="dot"></span><span class="dot"></span><span class="dot"></span> Sending</span>';

    try {
      const res = await fetch(EMAIL_ENDPOINT, { method:'POST', body: fd, mode:'cors', headers:{ 'Accept':'application/json' } });
      if(res.ok){
        showToast('Отчет успешно отправлен', 3000);
        form.reset();
        // refresh date/time
        const evt = new Event('input');
        document.getElementById('reported').dispatchEvent(evt);
      } else {
        showToast('AJAX не сработал — выполняю обычную отправку', 1800);
        // fallback: create form and submit
        const tmp = document.createElement('form');
        tmp.action = EMAIL_ENDPOINT;
        tmp.method = 'POST';
        tmp.style.display = 'none';
        for(const [k,v] of fd.entries()){
          const i = document.createElement('input');
          i.type = 'hidden'; i.name = k; i.value = v;
          tmp.appendChild(i);
        }
        document.body.appendChild(tmp);
        tmp.submit();
      }
    } catch(err){
      console.error(err);
      showToast('Ошибка сети — выполняю обычную отправку', 1800);
      const tmp = document.createElement('form');
      tmp.action = EMAIL_ENDPOINT;
      tmp.method = 'POST';
      tmp.style.display = 'none';
      for(const [k,v] of fd.entries()){
        const i = document.createElement('input');
        i.type = 'hidden'; i.name = k; i.value = v;
        tmp.appendChild(i);
      }
      document.body.appendChild(tmp);
      tmp.submit();
    } finally {
      submitBtn.disabled = false;
      submitBtn.innerHTML = orig;
    }
  });
})();

/* small parallax to make glass feel alive */
(function(){
  const card = document.querySelector('.card');
  let last = 0;
  window.addEventListener('scroll', () => {
    const s = window.scrollY;
    const t = Math.min(12, s / 40);
    card.style.transform = `translateY(${ -8 - t }px)`;
  }, { passive:true });
})();
</script>
</body>
</html>